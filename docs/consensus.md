# Алгоритмы консенсуса в блокчейне «ГАНИМЕД»

## Общее описание

Блокчейн «ГАНИМЕД» поддерживает динамическое переключение между двумя алгоритмами консенсуса:
- **Proof-of-Stake (PoS)**
- **Proof-of-Authority (PoA)**

Переключение возможно через конфигурационный файл или API, что позволяет гибко адаптировать сеть под различные требования безопасности и масштабируемости.

---

## Proof-of-Stake (PoS)

### Принципы работы

- Валидаторы выбираются на основе их стейка (bonding GND или иных подтверждающих активов).
- Чем больше стейк - тем выше вероятность быть выбранным для создания блока.
- Валидаторы получают награды за создание блоков и подтверждение транзакций.
- Для защиты от атак реализована система слэшинга и справедливого распределения наград.

### Основные этапы

1. **Стейкинг**  
   Участники блокируют определённое количество GND для участия в выборе валидаторов.

2. **Выбор валидатора**  
   На каждом раунде случайным образом (с учётом размера стейка) выбирается валидатор, который формирует новый блок.

3. **Награды и комиссии**  
   Валидатор получает комиссию (gas fees) и вознаграждение за созданный блок.

4. **Слэшинг**  
   За попытки атаки или нарушение правил часть стейка может быть конфискована.

### Пример структуры PoS

type PoS struct {
validators map[string]uint64 // адрес → стейк
running bool
}

text

---

## Proof-of-Authority (PoA)

### Принципы работы

- Блоки создаются доверенными (авторитетными) узлами, список которых хранится в конфигурации или выбирается голосованием.
- Каждый авторитетный узел идентифицирован и подписывает создаваемые блоки.
- Подходит для приватных и корпоративных сетей, где доверие между участниками известно заранее.

### Основные этапы

1. **Регистрация авторитетов**  
   Список авторитетных узлов задаётся при запуске сети или обновляется через специальный контракт/API.

2. **Генерация блоков**  
   Узлы по очереди или по расписанию создают новые блоки, подписывая их своим приватным ключом.

3. **Верификация**  
   Остальные участники проверяют подпись блока и соответствие авторитету.

### Пример структуры PoA

type PoA struct {
authorities []string // список доверенных адресов
running bool
}

text

---

## Динамическое переключение консенсуса

- Тип консенсуса выбирается через конфигурационный файл (`config.json`) или через специальный API.
- Переключение возможно без остановки сети (hot swap).
- Состояние консенсуса (валидаторы, авторитеты, стейкинг) хранится в отдельном модуле.

### Пример конфигурации

{
"consensus_type": "pos", // или "poa"
"gas_limit": 1000000,
"network_id": "ganymede-mainnet"
}

text

---

## API для управления консенсусом

- Получить текущий тип консенсуса:  
  `GET /consensus/type`
- Переключить тип консенсуса:  
  `POST /consensus/switch`  
  { "type": "poa" }


- Получить список валидаторов или авторитетов:  
  `GET /consensus/validators`  
  `GET /consensus/authorities`

---

## Валидация и безопасность

- Все блоки должны быть подписаны валидатором/авторитетом.
- Проверка подписи обязательна при добавлении блока.
- Для PoS реализован механизм слэшинга и динамического обновления состава валидаторов.
- Для PoA - прозрачная идентификация и аудит действий авторитетных узлов.

---

## Примеры сценариев

### Переключение консенсуса через API

1. Отправьте запрос:
   POST /consensus/switch
   Content-Type: application/json

{
"type": "poa"
}


2. Узлы переключатся на новый алгоритм без перезапуска сети.

### Добавление нового валидатора (PoS)

1. Отправьте транзакцию на стейкинг контракта с нужной суммой GND.
2. После подтверждения адрес появится в списке валидаторов.

### Добавление авторитета (PoA)

1. Администратор сети обновляет список доверенных адресов через API или контракт управления.

---

## Рекомендации по безопасности

- Регулярно проводить аудит состава валидаторов и авторитетов.
- Использовать многофакторную аутентификацию для управления ключами.
- Для публичных сетей рекомендуется использовать PoS, для приватных - PoA.

---

## Ссылки

- [api.md](api.md) - описание API для работы с токенами
- [contracts.md](contracts.md) - описание работы со смарт-контрактами
- [architecture.md](architecture.md) - архитектура блокчейна
- [consensus.md](consensus.md) - алгоритмы консенсуса
- [contracts.md](contracts.md) - работа со смарт-контрактами
- [integration.md](integration.md) - интеграция с GND


---